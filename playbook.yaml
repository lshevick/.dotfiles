- name: update and get
  hosts: local 
  become: true
  tasks:
    - name: Install packages with apt
      become: yes
      ansible.builtin.apt:
        name:
          - git
          - neofetch
          - fish
          - stow
          - fzf
        state: present

    - name: clone dotfiles
      ansible.builtin.git:
        repo: https://github.com/lshevick/.dotfiles.git
        dest: "{{ansible_env.HOME}}/.dotfiles"
        clone: true
        depth: 1

    - name: run stow 
      ansible.builtin.shell:
        chdir: ~/.dotfiles
        cmd: "stow . --t {{ansible_env.HOME}} --verbose=2"
        register: result
        changed_when: 'result.stderr is search("LINK: ")'


